# 📊 미답변 질문 로깅 시스템 가이드

## 🎯 개요

답변할 수 없었던 질문들을 자동으로 엑셀 파일에 저장하는 기능입니다.

### 왜 필요한가?
```
사용자: "회의실 예약 방법은?"
챗봇: "죄송합니다. 해당 질문에 대한 정보를 찾을 수 없습니다."
  ↓
📝 자동으로 로그 파일에 기록!
  ↓
👨‍💼 관리자가 나중에 확인하고 답변 추가
  ↓
🎉 챗봇이 더 똑똑해짐!
```

---

## 🚀 사용 방법

### 1. 자동 로깅 (사용자)
**아무것도 안 해도 됩니다!**

```
질문 입력 → 답변 못 찾음 → 자동으로 로그에 추가 ✅
```

### 2. 로그 확인 (관리자)

#### 방법 1: 웹에서 확인
```
1. 챗봇 화면 우측 하단 "📊 질문 로그" 클릭
2. 또는 http://localhost:5000/logs 접속
3. 미답변 질문 목록 확인
```

#### 방법 2: 엑셀 파일 직접 열기
```
파일 위치: logs/unanswered_questions.xlsx
Excel로 열기 → 확인 및 편집
```

---

## 📋 로그 파일 구조

### 엑셀 컬럼
```
┌────┬───────────────┬─────────────────┬────────┬─────┐
│번호│    질문       │      일시       │  상태  │비고 │
├────┼───────────────┼─────────────────┼────────┼─────┤
│ 1  │회의실 예약은? │2025-09-30 11:30 │미답변  │     │
│ 2  │휴가 신청 방법 │2025-09-30 11:45 │미답변  │     │
│ 3  │주차장 위치는? │2025-09-30 12:00 │미답변  │     │
└────┴───────────────┴─────────────────┴────────┴─────┘
```

### 컬럼 설명
- **번호**: 자동 증가 번호
- **질문**: 사용자가 입력한 질문
- **일시**: 질문한 시간 (년-월-일 시:분:초)
- **상태**: 미답변 / 답변완료
- **비고**: 메모 (수동 입력 가능)

---

## 🔄 워크플로우

### 사용자 → 챗봇
```
1. 사용자: "회의실 예약은?"
2. 챗봇: 유사도 계산
   - "그룹웨어 주소" → 0.234
   - "ERP 개발환경" → 0.123
   - 모두 0.5 미만!
3. 챗봇: "정보를 찾을 수 없습니다"
4. 자동 로깅: logs/unanswered_questions.xlsx에 추가 ✅
```

### 관리자 → 데이터 추가
```
1. http://localhost:5000/logs 접속
2. 미답변 질문 확인
   - "회의실 예약은?"
   - "휴가 신청 방법"
   - "주차장 위치는?"
3. data/data.xlsx 열기
4. 질문-답변 추가:
   질문: "회의실 예약은?"
   답변: "그룹웨어에서 회의실 메뉴를 클릭..."
5. 저장
6. 서버 재시작
7. 🎉 이제 챗봇이 답변 가능!
```

---

## 🌐 웹 로그 페이지

### 접속
```
http://localhost:5000/logs
```

### 기능
1. **통계 표시**
   - 전체 질문 수
   - 미답변 질문 수
   - 답변 완료 수

2. **질문 목록**
   - 번호, 질문, 일시, 상태, 비고
   - 상태별 색상 구분
   - 테이블 형식

3. **자동 새로고침**
   - 5초마다 자동 업데이트
   - 수동 새로고침 버튼

4. **플로팅 버튼**
   - 메인 챗봇 화면에 "📊 질문 로그" 버튼
   - 미답변 개수 배지 표시
   - 클릭 시 로그 페이지로 이동

---

## 📊 로그 통계

### 챗봇 메인 화면
```
우측 하단에 플로팅 버튼:
┌──────────────────┐
│ 📊 질문 로그  3  │ ← 미답변 3개
└──────────────────┘
```

### 로그 페이지
```
┌─────────────────────────────────────┐
│  전체 질문    미답변 질문   답변 완료 │
│     10           3           7      │
└─────────────────────────────────────┘
```

---

## 💡 활용 방법

### 1. 주기적 점검
```
매주 1회 → /logs 접속 → 미답변 질문 확인
→ 답변 작성 → data.xlsx에 추가
```

### 2. 인기 질문 파악
```
자주 로그되는 질문 = 많이 묻는 질문
→ 우선적으로 답변 추가
```

### 3. 검색 품질 개선
```
유사도 0.4 ~ 0.5 사이 질문들
→ 임계값 조정 또는 데이터 보강
```

---

## 🔧 고급 설정

### 로깅 비활성화
```python
# web_chatbot.py
chatbot = SemanticRAGChatbot(
    './data/data.xlsx',
    enable_logging=False  # 로깅 끄기
)
```

### 로그 파일 위치 변경
```python
# question_logger.py
logger = QuestionLogger(log_file='custom/path/questions.xlsx')
```

### 임계값 조정
```python
# rag_chatbot_v2.py - 148번째 줄
similar_qas = self._find_similar_qa(question, threshold=0.5)
#                                                      ↑
#                                            0.4로 낮추면 더 많이 찾음
#                                            0.6으로 높이면 더 정확하게
```

---

## 📈 예시 시나리오

### Day 1
```
사용자 질문:
- "회의실 예약은?" → 못 찾음 → 로그 추가
- "휴가 신청 방법" → 못 찾음 → 로그 추가
- "주차장 위치는?" → 못 찾음 → 로그 추가

로그 파일: 3개 질문 기록
```

### Day 2
```
관리자:
1. /logs 접속
2. 3개 미답변 질문 확인
3. data.xlsx에 답변 추가
4. 서버 재시작

이제 답변 가능! ✅
```

### Day 3
```
사용자 질문:
- "회의실 예약은?" → 답변 성공! ✅
- "휴가 신청 방법" → 답변 성공! ✅
- "복지 혜택은?" → 못 찾음 → 새로 로그 추가

로그 파일: 1개 신규 질문
```

---

## 🎯 자동화 팁

### 엑셀 자동 정리
```python
# 로그 파일을 정렬하여 저장
df = pd.read_excel('logs/unanswered_questions.xlsx')
df_sorted = df.sort_values('일시', ascending=False)
df_sorted.to_excel('logs/unanswered_questions.xlsx', index=False)
```

### 이메일 알림 (선택)
```python
# 미답변 질문 10개 이상 시 이메일
if question_logger.get_unanswered_count() >= 10:
    send_email("미답변 질문 10개 누적!")
```

---

## 📊 통계 및 분석

### 로그 데이터로 할 수 있는 것:

1. **인기 주제 파악**
   ```python
   # 단어 빈도 분석
   questions = df['질문'].str.lower()
   keywords = questions.str.split().explode()
   keywords.value_counts()
   ```

2. **시간대별 분석**
   ```python
   # 많이 물어보는 시간
   df['시간'] = pd.to_datetime(df['일시']).dt.hour
   df['시간'].value_counts()
   ```

3. **답변률 계산**
   ```python
   # 전체 대비 답변 성공률
   total = len(df)
   answered = len(df[df['상태'] == '답변완료'])
   rate = answered / total * 100
   ```

---

## 🔒 보안 및 프라이버시

### 주의사항
- 개인정보 포함 질문 주의
- 민감 정보는 수동 삭제
- 로그 파일 접근 권한 관리

### 권장사항
```
1. 주기적으로 로그 파일 백업
2. 개인정보 포함 질문 삭제
3. 로그 파일 암호화 (필요시)
```

---

## 📁 파일 위치

```
ktrGPT/
├── logs/
│   └── unanswered_questions.xlsx    ← 로그 파일 (자동 생성)
│
├── question_logger.py               ← 로깅 로직
├── rag_chatbot_v2.py                ← 로거 통합
├── web_chatbot.py                   ← API 엔드포인트
└── templates/
    ├── index.html                   ← 메인 (로그 버튼 추가)
    └── logs.html                    ← 로그 조회 페이지
```

---

## 🎉 완성!

### 추가된 기능
✅ 알 수 없는 질문 자동 로깅
✅ 엑셀 파일로 저장
✅ 웹에서 로그 조회
✅ 실시간 통계
✅ 중복 질문 자동 제거
✅ 미답변 개수 배지

### 사용법
1. 평소처럼 챗봇 사용
2. 답변 못 찾은 질문은 자동 저장
3. 주기적으로 `/logs` 확인
4. `data.xlsx`에 답변 추가
5. 챗봇이 더 똑똑해짐!

---

**Made with ❤️ for KTR**
